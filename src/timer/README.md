# 定时器

## `sort_timer_lst` 类相关函数：

1. **`sort_timer_lst` 构造函数**：这是 `sort_timer_lst` 类的构造函数。它初始化计时器链表，将链表的头部和尾部指针都设为 `NULL`，表示链表开始为空。

2. **`~sort_timer_lst` 析构函数**：这是 `sort_timer_lst` 类的析构函数。它用于释放计时器链表中的所有计时器对象的内存。它会遍历整个链表，删除每个计时器对象，并释放其占用的内存。

3. **`add_timer(util_timer *timer, util_timer *lst_head)` 函数**：这个函数用于将计时器对象 `timer` 插入到链表中，并保持链表按照计时器的过期时间从小到大的顺序排列。参数 `lst_head` 表示链表的头部，即插入位置的前一个计时器。

4. **`add_timer(util_timer *timer)` 函数**：这个函数用于将计时器对象 `timer` 插入到链表中，自动根据计时器的过期时间进行排序。如果链表为空，将该计时器作为唯一的头尾。

5. **`adjust_timer(util_timer *timer)` 函数**：这个函数用于调整计时器对象 `timer` 在链表中的位置。它检查 `timer` 是否需要移到更靠前的位置，如果需要，则会将其重新插入到链表中，保持链表的有序性。

6. **`del_timer(util_timer *timer)` 函数**：这个函数用于从链表中删除计时器对象 `timer`，释放其占用的内存。它根据 `timer` 的位置在链表中进行删除操作。

7. **`tick()` 函数**：这个函数用于处理计时器链表中已经到期的计时器。它会遍历链表，查找过期的计时器，然后执行相应的回调函数，并将这些计时器从链表中删除。

## `Utils` 类相关函数：

1. **`init(int timeslot)` 函数**：这个函数用于初始化工具类，设置最小超时单位为 `timeslot`。它会将 `timeslot` 存储在类的成员变量中，以便后续使用。

2. **`set_nonblocking(int fd)` 函数**：这个函数用于将文件描述符 `fd` 设置为非阻塞模式。它通过调用 `fcntl` 函数来实现，将文件描述符的标志位修改为非阻塞模式。

3. **`add_fd(int epoll_fd, int fd, bool one_shot, int trig_mode)` 函数**：这个函数用于注册文件描述符 `fd` 到 epoll 事件表中。根据参数 `trig_mode` 的不同值，设置事件类型，可以监听可读事件（有数据可读）和连接关闭事件。如果 `one_shot` 为 `true`，则添加 EPOLLONESHOT 标志，以实现单次触发。

4. **`sig_handler(int sig)` 函数**：这个函数是信号处理函数，用于处理接收到的信号 `sig`。它将 `sig` 的值发送到管道的写端，以通知主循环处理相应的信号。

5. **`add_sig(int sig, void(handler)(int), bool restart)` 函数**：这个函数用于注册信号处理函数。它接受信号编号 `sig`、信号处理函数的指针 `handler`，以及是否启用信号重启机制的标志 `restart`。它使用 `sigaction` 函数来注册信号处理动作，可以选择是否启用信号重启机制。

6. **`timer_handler()` 函数**：这个函数用于处理定时器事件。它调用计时器链表对象的 `tick` 函数，触发已到期的计时器的回调函数，并重新设置定时器。

7. **`show_error(int conn_fd, const char *info)` 函数**：这个函数用于向指定的连接文件描述符 `conn_fd` 发送错误信息 `info`，然后关闭连接。它用于处理发生错误时向客户端发送错误信息并关闭连接的情况。

## 其他函数：

8. **`cb_func(client_data *user_data)` 函数**：这个函数是一个回调函数，用于处理超时的客户端连接。它从 epoll 实例中删除连接，并关闭连接套接字，同时减少连接计数。这个函数在计时器到期时被调用，用于处理连接超时的情况。