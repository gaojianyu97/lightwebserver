# 数据库连接池

## `connection_pool` 类

该类的主要作用是管理数据库连接池。

1. **构造函数和析构函数**：
   - 构造函数：初始化了当前连接数 `m_cur_conn` 和空闲连接数 `m_free_conn` 为0。
   - 析构函数：调用 `destory_pool()` 方法销毁连接池。

2. **`get_instance()` 静态方法**：
   - 实现了单例模式，确保只有一个 `connection_pool` 对象。
   - 返回静态的 `connection_pool` 实例。

3. **`init()` 方法**：
   - 初始化连接池，设置数据库连接参数，并创建指定数量的数据库连接。
   - 参数包括数据库主机地址 `url`、用户名 `user`、密码 `passward`、数据库名 `database_name`、端口号 `port`、最大连接数 `max_conn`、日志开关 `close_log`。
   - 在循环中创建连接，并将连接添加到连接池中。
   - 使用 `sem` 初始化信号量 `reserve`，初始值为空闲连接的数量。
   - 设置最大连接数为空闲连接数。

4. **`get_connecton()` 方法**：
   - 获取数据库连接。
   - 如果连接池为空，则返回 `NULL`。
   - 使用信号量 `reserve` 等待信号量，表示获取一个连接。
   - 上锁，从连接池中取出一个连接，更新当前连接数和空闲连接数，然后解锁并返回获得的连接。

5. **`release_connection()` 方法**：
   - 释放数据库连接。
   - 如果传入的连接是 `NULL`，则返回 `false`。
   - 上锁，将连接放回连接池底部，更新空闲连接数和当前连接数。
   - 解锁，然后释放信号量，表示连接已被释放回连接池。

6. **`destory_pool()` 方法**：
   - 销毁连接池，关闭所有连接。
   - 上锁，循环关闭连接，清空连接池，重置当前连接数和空闲连接数为0，最后解锁。

7. **`get_free_conn()` 方法**：
   - 返回当前空闲连接数。

## `connection_raii` 类

该类的主要作用是自动管理数据库连接资源。

1. **构造函数**：
   - 构造函数接受一个指向 `MYSQL*` 类型的指针 `conn` 和一个 `connection_pool` 类型的指针 `conn_pool`。
   - 通过调用连接池的 `get_connection()` 方法获取一个连接，将其赋值给 `conn`。

2. **析构函数**：
   - 析构函数会在作用域结束时自动释放连接，通过调用连接池的 `release_connection()` 方法来完成释放。

这两个类一起工作，使得在使用数据库连接的过程中可以自动获取和释放连接，确保资源正确管理，避免泄漏。
